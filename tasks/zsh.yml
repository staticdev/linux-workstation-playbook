---
- name: Install zsh package
  ansible.builtin.apt:
    name: zsh
  become: true

- name: Set zsh as default
  ansible.builtin.user:
    name: "{{ ansible_facts.user_id }}"
    shell: /usr/bin/zsh
  become: true
  when: zsh_default_shell

- name: Add line to .zshrc for Nix profile
  ansible.builtin.lineinfile:
    dest: "{{ ansible_env.HOME }}/.zshrc"
    line: 'if [ -e "{{ ansible_env.HOME }}/.nix-profile/etc/profile.d/nix.sh" ]; then . "{{ ansible_env.HOME }}/.nix-profile/etc/profile.d/nix.sh"; fi # added by ansible playbook'
    create: true
    insertafter: EOF
